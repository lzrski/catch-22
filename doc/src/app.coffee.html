<!DOCTYPE html><html lang="en"><head><title>src/app.coffee</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/app.coffee"><meta name="groc-project-path" content="src/app.coffee.md"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/app.coffee.md</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="application">Application</h1>

<p>An online gallery of vicious circles.</p>

<p>It's an application to let people share insights on <a href="http://en.wikipedia.org/wiki/Vicious_circle">vicious circles</a> they are affected by or they know about. Also it lets participants share their solutions to the circles and vote for them.</p>

<p>Learn more at https://github.com/lzrski/catch-22</p>

<p>This file is an entry point of the app (see [./package.json][]).</p>

<p>The app is <a href="http://flatironjs.org/">Flatiron</a> based. Templates are powered by <a href="https://github.com/twilson63/creamer">Creamer</a> - an excelent <a href="https://github.com/gradus/coffeecup">Coffecup</a> plugin with MVC capabilities. User authentication uses <a href="http://www.mozilla.org/en-US/persona/">Mozilla Persona</a> with my humble <a href="https://github.com/lzrski/flatiron-persona">plugin</a>, which requires session and cookie parser middleware from <a href="http://www.senchalabs.org/connect/">Connect</a>. </p>

<pre><code>flatiron = require 'flatiron'
creamer  = require 'creamer'
persona  = require 'flatiron-persona'
connect  = require "connect"
app      = flatiron.app
</code></pre>

<p>Runtime configuration is done with <a href="https://github.com/flatiron/nconf">nconf</a></p>

<pre><code>app.config.defaults {
  host    : "localhost"
  port    : 4000
  secret  : "Kiedy nikogo nie ma w domu, Katiusza maluje pazury na zielono i głośno się śmieje swoim kocim głosem. To prawda!"
}
# TODO: Doesn't read ?
app.config.file file: __dirname + '/../config/config.json' 

app.use flatiron.plugins.http
# TODO: this should be somehow configurable
app.use persona, audience: "http://localhost:4000/" 
app.use creamer,
  layout:       require "./views/layout"
  views:        __dirname + '/views'
  controllers:  __dirname + '/controllers'

app.http.before.push do connect.cookieParser
app.http.before.push connect.session secret: app.config.get "secret"
</code></pre>

<p>Let's start listening to requests from our participants:</p>

<pre><code>app.start (app.config.get "port"), -&gt;
  app.log.info "The circles are turning at http://#{app.config.get "host"}:#{app.config.get "port"}/}"
</code></pre></div></div></div></div></body></html>